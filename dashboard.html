<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>增强版节点监控面板</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 30px; backdrop-filter: blur(10px); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(255,255,255,0.95); padding: 25px; border-radius: 15px; backdrop-filter: blur(10px); transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 2.5em; font-weight: bold; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nodes-table { background: rgba(255,255,255,0.95); border-radius: 15px; overflow: hidden; backdrop-filter: blur(10px); }
        .table-header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .status-good { color: #28a745; font-weight: bold; }
        .status-bad { color: #dc3545; font-weight: bold; }
        .speed-excellent { background: linear-gradient(90deg, #28a745, #20c997); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
        .speed-good { background: linear-gradient(90deg, #ffc107, #fd7e14); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
        .speed-poor { background: linear-gradient(90deg, #dc3545, #e83e8c); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
        .refresh-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .refresh-btn:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .streaming-icons { display: flex; gap: 5px; flex-wrap: wrap; }
        .streaming-icon { font-size: 1.2em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 增强版节点监控面板</h1>
            <p>实时监控节点状态、速度和流媒体解锁情况</p>
            <button class="refresh-btn" onclick="loadData()">🔄 刷新数据</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalNodes">-</div>
                <div>总节点数</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">包含所有测试节点</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="aliveNodes">-</div>
                <div>可用节点</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">通过连通性测试</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgPing">-</div>
                <div>平均延迟</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">毫秒 (ms)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgSpeed">-</div>
                <div>平均速度</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">MB/s</div>
            </div>
        </div>

        <div class="nodes-table">
            <div class="table-header">
                <h2>🏆 优质节点排行榜</h2>
                <p>按综合质量评分排序，包含延迟、速度、解锁能力</p>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>排名</th>
                        <th>节点名称</th>
                        <th>地区</th>
                        <th>延迟</th>
                        <th>速度</th>
                        <th>流媒体</th>
                        <th>状态</th>
                    </tr>
                </thead>
                <tbody id="nodesTableBody">
                    <tr><td colspan="7" style="text-align: center; padding: 40px;">正在加载数据...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('report_latest.json');
                const data = await response.json();
                
                // 更新统计数据
                const stats = data.test_summary;
                document.getElementById('totalNodes').textContent = stats.total_nodes;
                document.getElementById('aliveNodes').textContent = stats.alive_nodes;
                document.getElementById('avgPing').textContent = stats.avg_tcp_ping.toFixed(1);
                document.getElementById('avgSpeed').textContent = stats.avg_download_speed.toFixed(2);
                
                // 更新节点表格
                const tbody = document.getElementById('nodesTableBody');
                tbody.innerHTML = '';
                
                data.top_nodes.forEach((node, index) => {
                    const row = document.createElement('tr');
                    
                    // 速度评级
                    let speedClass = 'speed-poor';
                    const speed = parseFloat(node.speed);
                    if (speed > 5) speedClass = 'speed-excellent';
                    else if (speed > 2) speedClass = 'speed-good';
                    
                    // 流媒体图标
                    let streamingIcons = '';
                    if (data.streaming_support && data.streaming_support[node.name]) {
                        const streaming = data.streaming_support[node.name];
                        if (streaming.netflix && streaming.netflix.includes('✅')) streamingIcons += '🎬';
                        if (streaming.youtube && streaming.youtube.includes('✅')) streamingIcons += '📺';
                        if (streaming.disney && streaming.disney.includes('✅')) streamingIcons += '🏰';
                        if (streaming.bilibili && streaming.bilibili.includes('✅')) streamingIcons += '📱';
                    }
                    
                    row.innerHTML = `
                        <td><strong>#${index + 1}</strong></td>
                        <td>${node.name}</td>
                        <td>${node.country}</td>
                        <td>${node.ping}</td>
                        <td><span class="${speedClass}">${node.speed}</span></td>
                        <td><div class="streaming-icons">${streamingIcons || '🔍'}</div></td>
                        <td><span class="status-good">✅ 优质</span></td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                console.log('数据更新完成');
                
            } catch (error) {
                console.error('数据加载失败:', error);
                document.getElementById('nodesTableBody').innerHTML = 
                    '<tr><td colspan="7" style="text-align: center; color: red;">数据加载失败，请检查网络连接</td></tr>';
            }
        }
        
        // 页面加载时自动加载数据
        window.onload = loadData;
        
        // 每5分钟自动刷新
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
