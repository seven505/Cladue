<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢å¼ºç‰ˆèŠ‚ç‚¹ç›‘æ§é¢æ¿</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 30px; backdrop-filter: blur(10px); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(255,255,255,0.95); padding: 25px; border-radius: 15px; backdrop-filter: blur(10px); transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 2.5em; font-weight: bold; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nodes-table { background: rgba(255,255,255,0.95); border-radius: 15px; overflow: hidden; backdrop-filter: blur(10px); }
        .table-header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .status-good { color: #28a745; font-weight: bold; }
        .status-bad { color: #dc3545; font-weight: bold; }
        .speed-excellent { background: linear-gradient(90deg, #28a745, #20c997); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
        .speed-good { background: linear-gradient(90deg, #ffc107, #fd7e14); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
        .speed-poor { background: linear-gradient(90deg, #dc3545, #e83e8c); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
        .refresh-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .refresh-btn:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .streaming-icons { display: flex; gap: 5px; flex-wrap: wrap; }
        .streaming-icon { font-size: 1.2em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ å¢å¼ºç‰ˆèŠ‚ç‚¹ç›‘æ§é¢æ¿</h1>
            <p>å®æ—¶ç›‘æ§èŠ‚ç‚¹çŠ¶æ€ã€é€Ÿåº¦å’Œæµåª’ä½“è§£é”æƒ…å†µ</p>
            <button class="refresh-btn" onclick="loadData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalNodes">-</div>
                <div>æ€»èŠ‚ç‚¹æ•°</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">åŒ…å«æ‰€æœ‰æµ‹è¯•èŠ‚ç‚¹</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="aliveNodes">-</div>
                <div>å¯ç”¨èŠ‚ç‚¹</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">é€šè¿‡è¿é€šæ€§æµ‹è¯•</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgPing">-</div>
                <div>å¹³å‡å»¶è¿Ÿ</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">æ¯«ç§’ (ms)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgSpeed">-</div>
                <div>å¹³å‡é€Ÿåº¦</div>
                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">MB/s</div>
            </div>
        </div>

        <div class="nodes-table">
            <div class="table-header">
                <h2>ğŸ† ä¼˜è´¨èŠ‚ç‚¹æ’è¡Œæ¦œ</h2>
                <p>æŒ‰ç»¼åˆè´¨é‡è¯„åˆ†æ’åºï¼ŒåŒ…å«å»¶è¿Ÿã€é€Ÿåº¦ã€è§£é”èƒ½åŠ›</p>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>æ’å</th>
                        <th>èŠ‚ç‚¹åç§°</th>
                        <th>åœ°åŒº</th>
                        <th>å»¶è¿Ÿ</th>
                        <th>é€Ÿåº¦</th>
                        <th>æµåª’ä½“</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody id="nodesTableBody">
                    <tr><td colspan="7" style="text-align: center; padding: 40px;">æ­£åœ¨åŠ è½½æ•°æ®...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('report_latest.json');
                const data = await response.json();
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                const stats = data.test_summary;
                document.getElementById('totalNodes').textContent = stats.total_nodes;
                document.getElementById('aliveNodes').textContent = stats.alive_nodes;
                document.getElementById('avgPing').textContent = stats.avg_tcp_ping.toFixed(1);
                document.getElementById('avgSpeed').textContent = stats.avg_download_speed.toFixed(2);
                
                // æ›´æ–°èŠ‚ç‚¹è¡¨æ ¼
                const tbody = document.getElementById('nodesTableBody');
                tbody.innerHTML = '';
                
                data.top_nodes.forEach((node, index) => {
                    const row = document.createElement('tr');
                    
                    // é€Ÿåº¦è¯„çº§
                    let speedClass = 'speed-poor';
                    const speed = parseFloat(node.speed);
                    if (speed > 5) speedClass = 'speed-excellent';
                    else if (speed > 2) speedClass = 'speed-good';
                    
                    // æµåª’ä½“å›¾æ ‡
                    let streamingIcons = '';
                    if (data.streaming_support && data.streaming_support[node.name]) {
                        const streaming = data.streaming_support[node.name];
                        if (streaming.netflix && streaming.netflix.includes('âœ…')) streamingIcons += 'ğŸ¬';
                        if (streaming.youtube && streaming.youtube.includes('âœ…')) streamingIcons += 'ğŸ“º';
                        if (streaming.disney && streaming.disney.includes('âœ…')) streamingIcons += 'ğŸ°';
                        if (streaming.bilibili && streaming.bilibili.includes('âœ…')) streamingIcons += 'ğŸ“±';
                    }
                    
                    row.innerHTML = `
                        <td><strong>#${index + 1}</strong></td>
                        <td>${node.name}</td>
                        <td>${node.country}</td>
                        <td>${node.ping}</td>
                        <td><span class="${speedClass}">${node.speed}</span></td>
                        <td><div class="streaming-icons">${streamingIcons || 'ğŸ”'}</div></td>
                        <td><span class="status-good">âœ… ä¼˜è´¨</span></td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                console.log('æ•°æ®æ›´æ–°å®Œæˆ');
                
            } catch (error) {
                console.error('æ•°æ®åŠ è½½å¤±è´¥:', error);
                document.getElementById('nodesTableBody').innerHTML = 
                    '<tr><td colspan="7" style="text-align: center; color: red;">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</td></tr>';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
        window.onload = loadData;
        
        // æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
